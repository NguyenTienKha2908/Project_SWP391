<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add New Diamond</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #333; margin: 0; padding: 0; color: #fff; }
        .container { width: 50%; margin: auto; overflow: hidden; }
        header { background: #444; color: #fff; padding-top: 30px; min-height: 70px; border-bottom: #77d4d8 3px solid; }
        header a { color: #fff; text-decoration: none; text-transform: uppercase; font-size: 16px; }
        form { background: #222; padding: 20px; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        label { display: block; margin-bottom: 10px; }
        input[type="text"], input[type="file"], select, textarea { width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #555; border-radius: 5px; background: #333; color: #fff; }
        input[type="submit"] { display: inline-block; padding: 10px 15px; font-size: 14px; cursor: pointer; text-align: center; text-decoration: none; outline: none; color: #fff; background-color: #4CAF50; border: none; border-radius: 15px; box-shadow: 0 9px #999; }
        input[type="submit"]:hover { background-color: #3e8e41 }
        input[type="submit"]:active { background-color: #3e8e41; box-shadow: 0 5px #666; transform: translateY(4px); }
        .btn { display: inline-block; padding: 10px 15px; font-size: 14px; cursor: pointer; text-align: center; text-decoration: none; outline: none; color: #fff; background-color: #4CAF50; border: none; border-radius: 15px; box-shadow: 0 9px #999; margin: 10px 0; }
        .btn:hover { background-color: #3e8e41 }
        .btn:active { background-color: #3e8e41; box-shadow: 0 5px #666; transform: translateY(4px); }
        .btn-secondary { background-color: #555; }
        .btn-secondary:hover { background-color: #444; }
        .btn-secondary:active { background-color: #444; }
        .combined-input { display: flex; align-items: center; margin-bottom: 20px; }
        .combined-input input[type="file"] { flex: 2; margin-right: 10px; }
        .combined-input input[type="text"] { flex: 8; }
        .error-tooltip { color: #f00; font-size: 12px; margin-top: -10px; margin-bottom: 10px; }
        .note { color: #77d4d8; font-size: 14px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Add New Diamond</h1>
        </div>
    </header>
    <div class="container">
        <div class="note">Please select options from top to bottom for it to work correctly.</div>
        <form th:action="@{/addDiamond}" th:object="${diamond}" method="post" enctype="multipart/form-data">
            <label>Diamond Code:
                <input type="text" th:field="*{dia_code}" readonly="readonly" />
            </label>
            <div th:if="${#fields.hasErrors('dia_code')}" th:errors="*{dia_code}" class="error-tooltip">
                Error message
            </div>
            <label>Diamond Name:
                <input type="text" th:field="*{dia_name}" placeholder="Enter Diamond Name" />
            </label>
            <div th:if="${#fields.hasErrors('dia_name')}" th:errors="*{dia_name}" class="error-tooltip">
                Error message
            </div>
            <label>Origin:
                <select th:field="*{origin}" id="origin" onchange="fetchColorOptions()">
                    <option value="">Select Origin</option>
                    <option th:each="origin : ${origins}" th:value="${origin}" th:text="${origin}"></option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('origin')}" th:errors="*{origin}" class="error-tooltip">
                Error message
            </div>

            <label>Carat Weight:
                <input type="text" th:field="*{carat_weight}" id="carat_weight" onchange="fetchColorOptions()" placeholder="Enter Carat Weight" />
            </label>
            <div th:if="${#fields.hasErrors('carat_weight')}" th:errors="*{carat_weight}" class="error-tooltip">
                Error message
            </div>

            <label>Color:
                <select th:field="*{color}" id="color" onchange="fetchClarityOptions()">
                    <option value="">Select Color</option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('color')}" th:errors="*{color}" class="error-tooltip">
                Error message
            </div>

            <label>Clarity:
                <select th:field="*{clarity}" id="clarity" onchange="fetchCutOptions()">
                    <option value="">Select Clarity</option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('clarity')}" th:errors="*{clarity}" class="error-tooltip">
                Error message
            </div>

            <label>Cut:
                <select th:field="*{cut}" id="cut">
                    <option value="">Select Cut</option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('cut')}" th:errors="*{cut}" class="error-tooltip">
                Error message
            </div>

            <button type="button" class="btn" onclick="calculatePrice()">Calculate Price</button>
            <label>Q Price:
                <input type="text" th:field="*{q_price}" readonly="readonly" />
            </label>
            <input type="hidden" th:field="*{o_price}" value="0.0" />
            <label>Proportions:
                <select th:field="*{proportions}">
                    <option value="Excellent">Excellent</option>
                    <option value="Very good">Very good</option>
                    <option value="Good">Good</option>
                    <option value="Fair">Fair</option>
                    <option value="Poor">Poor</option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('proportions')}" th:errors="*{proportions}" class="error-tooltip">
                Error message
            </div>

            <label>Polish:
                <select th:field="*{polish}">
                    <option value="Excellent">Excellent</option>
                    <option value="Very good">Very good</option>
                    <option value="Good">Good</option>
                    <option value="Fair">Fair</option>
                    <option value="Poor">Poor</option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('polish')}" th:errors="*{polish}" class="error-tooltip">
                Error message
            </div>

            <label>Symmetry:
                <select th:field="*{symmetry}">
                    <option value="Excellent">Excellent</option>
                    <option value="Very good">Very good</option>
                    <option value="Good">Good</option>
                    <option value="Fair">Fair</option>
                    <option value="Poor">Poor</option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('symmetry')}" th:errors="*{symmetry}" class="error-tooltip">
                Error message
            </div>

            <label>Fluorescence:
                <select th:field="*{fluorescence}">
                    <option value="None">None</option>
                    <option value="Faint">Faint</option>
                    <option value="Medium">Medium</option>
                    <option value="Strong">Strong</option>
                    <option value="Very Strong">Very Strong</option>
                </select>
            </label>
            <div th:if="${#fields.hasErrors('fluorescence')}" th:errors="*{fluorescence}" class="error-tooltip">
                Error message
            </div>

            <label>Image URL or Upload Image:</label>
            <div class="combined-input">
                <input type="file" name="imgFile" />
                <input type="text" th:field="*{img_url}" placeholder="Enter image URL" />
            </div>
            <div th:if="${#fields.hasErrors('img_url')}" th:errors="*{img_url}" class="error-tooltip">
                Error message
            </div>
            <div th:if="${#fields.hasErrors('img_file')}" th:errors="*{img_file}" class="error-tooltip">
                Error message
            </div>

            <input type="submit" value="Add Diamond" />
        </form>
        <a th:href="@{/diamonds}" class="btn btn-secondary">Back to Diamonds</a>
    </div>
    <script>
        function fetchColorOptions() {
            const origin = document.getElementById("origin").value;
            const carat_weight = parseFloat(document.getElementById("carat_weight").value);

            if (!origin || isNaN(carat_weight)) {
                document.getElementById("color").innerHTML =
                    '<option value="">Select Color</option>';
                return;
            }

            fetch(`/getPriceListByColor?origin=${origin}&carat_weight=${carat_weight}`)
                .then((response) => response.json())
                .then((data) => {
                    const colorSelect = document.getElementById("color");
                    colorSelect.innerHTML = '<option value="">Select Color</option>';
                    const colors = [...new Set(data)]; // Unique color values
                    colors.forEach((color) => {
                        colorSelect.innerHTML += `<option value="${color}">${color}</option>`;
                    });
                })
                .catch((error) => {
                    console.error('Error fetching color options:', error);
                });
        }

        function fetchClarityOptions() {
            const origin = document.getElementById("origin").value;
            const carat_weight = parseFloat(document.getElementById("carat_weight").value);
            const color = document.getElementById("color").value;

            if (!origin || isNaN(carat_weight) || !color) {
                document.getElementById("clarity").innerHTML =
                    '<option value="">Select Clarity</option>';
                return;
            }

            fetch(`/getPriceListByClarity?origin=${origin}&carat_weight=${carat_weight}&color=${color}`)
                .then((response) => response.json())
                .then((data) => {
                    const claritySelect = document.getElementById("clarity");
                    claritySelect.innerHTML = '<option value="">Select Clarity</option>';
                    const clarities = [...new Set(data)]; // Unique clarity values
                    clarities.forEach((clarity) => {
                        claritySelect.innerHTML += `<option value="${clarity}">${clarity}</option>`;
                    });
                })
                .catch((error) => {
                    console.error('Error fetching clarity options:', error);
                });
        }

        function fetchCutOptions() {
            const origin = document.getElementById("origin").value;
            const carat_weight = parseFloat(document.getElementById("carat_weight").value);
            const color = document.getElementById("color").value;
            const clarity = document.getElementById("clarity").value;

            if (!origin || isNaN(carat_weight) || !color || !clarity) {
                document.getElementById("cut").innerHTML =
                    '<option value="">Select Cut</option>';
                return;
            }

            fetch(`/getPriceListByCut?origin=${origin}&carat_weight=${carat_weight}&color=${color}&clarity=${clarity}`)
                .then((response) => response.json())
                .then((data) => {
                    const cutSelect = document.getElementById("cut");
                    cutSelect.innerHTML = '<option value="">Select Cut</option>';
                    const cuts = [...new Set(data)]; // Unique cut values
                    cuts.forEach((cut) => {
                        cutSelect.innerHTML += `<option value="${cut}">${cut}</option>`;
                    });
                })
                .catch((error) => {
                    console.error('Error fetching cut options:', error);
                });
        }

        function calculatePrice() {
            const origin = document.getElementById("origin").value;
            const carat_weight = parseFloat(document.getElementById("carat_weight").value);
            const color = document.getElementById("color").value;
            const clarity = document.getElementById("clarity").value;
            const cut = document.getElementById("cut").value;

            if (!origin || isNaN(carat_weight) || !color || !clarity || !cut) {
                document.querySelector('input[name="q_price"]').value = "";
                return;
            }

            fetch(`/getPriceListByDetails?origin=${origin}&carat_weight=${carat_weight}&color=${color}&clarity=${clarity}&cut=${cut}`)
                .then((response) => response.json())
                .then((data) => {
                    const qPriceInput = document.querySelector('input[name="q_price"]');

                    if (data) {
                        qPriceInput.value = data.price;
                    } else {
                        qPriceInput.value = "";
                    }
                })
                .catch((error) => {
                    console.error('Error calculating price:', error);
                });
        }
    </script>

</body>
</html>
